"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.handleCueImage = handleCueImage;
exports.TEIScroll = TEIScroll;
exports.handleCueAudio = handleCueAudio;
exports.handleCueVideo = handleCueVideo;
exports.handleEmphasis = handleEmphasis;
exports.handleHighlight = handleHighlight;
exports.handleHighlight2 = handleHighlight2;
exports.handleIdentifyMuzicode = handleIdentifyMuzicode;
exports.handleChoiceMuzicode = handleChoiceMuzicode;
exports.handleChallengePassed = handleChallengePassed;
exports.handleDisklavierStart = handleDisklavierStart;
exports.handleMuzicodeTriggered = handleMuzicodeTriggered;
exports.handleArchivedMuzicodeTrigger = handleArchivedMuzicodeTrigger;
exports.handleQueueNextSession = handleQueueNextSession;
exports.handleCreateNextSession = handleCreateNextSession;
exports.handleTransitionToNextSession = handleTransitionToNextSession;
exports.QUEUE_NEXT_SESSION = exports.ANNOTATION_SKIPPED = exports.ANNOTATION_POSTED = exports.ANNOTATION_PATCHED = exports.ANNOTATION_NOT_HANDLED = exports.ANNOTATION_HANDLED = exports.CUE_IMAGE_HANDLED = exports.CUE_IMAGE = exports.CUE_VIDEO_HANDLED = exports.CUE_VIDEO = exports.CUE_AUDIO_HANDLED = exports.CUE_AUDIO = exports.MARKUP_HIGHLIGHT2 = exports.MARKUP_HIGHLIGHT = exports.MARKUP_EMPHASIS = void 0;

var _index = require("./index");

var MARKUP_EMPHASIS = "meldterm:emphasis";
exports.MARKUP_EMPHASIS = MARKUP_EMPHASIS;
var MARKUP_HIGHLIGHT = "meldterm:highlight";
exports.MARKUP_HIGHLIGHT = MARKUP_HIGHLIGHT;
var MARKUP_HIGHLIGHT2 = "meldterm:highlight2";
exports.MARKUP_HIGHLIGHT2 = MARKUP_HIGHLIGHT2;
var CUE_AUDIO = "meldterm:CueAudio";
exports.CUE_AUDIO = CUE_AUDIO;
var CUE_AUDIO_HANDLED = "CUE_AUDIO_HANDLED";
exports.CUE_AUDIO_HANDLED = CUE_AUDIO_HANDLED;
var CUE_VIDEO = "meldterm:CueVideo";
exports.CUE_VIDEO = CUE_VIDEO;
var CUE_VIDEO_HANDLED = "CUE_VIDEO_HANDLED";
exports.CUE_VIDEO_HANDLED = CUE_VIDEO_HANDLED;
var CUE_IMAGE = "meldterm:CueImage";
exports.CUE_IMAGE = CUE_IMAGE;
var CUE_IMAGE_HANDLED = "CUE_IMAGE_HANDLED";
exports.CUE_IMAGE_HANDLED = CUE_IMAGE_HANDLED;
var ANNOTATION_HANDLED = "ANNOTATION_HANDLED";
exports.ANNOTATION_HANDLED = ANNOTATION_HANDLED;
var ANNOTATION_NOT_HANDLED = "ANNOTATION_NOT_HANDLED";
exports.ANNOTATION_NOT_HANDLED = ANNOTATION_NOT_HANDLED;
var ANNOTATION_PATCHED = "ANNOTATION_PATCHED";
exports.ANNOTATION_PATCHED = ANNOTATION_PATCHED;
var ANNOTATION_POSTED = "ANNOTATION_POSTED";
exports.ANNOTATION_POSTED = ANNOTATION_POSTED;
var ANNOTATION_SKIPPED = "ANNOTATION_SKIPPED";
exports.ANNOTATION_SKIPPED = ANNOTATION_SKIPPED;
var QUEUE_NEXT_SESSION = "QUEUE_NEXT_SESSION";
exports.QUEUE_NEXT_SESSION = QUEUE_NEXT_SESSION;

function handleCueImage(component, annotation, uri, fragments, fragImages) {
  var haveImages = fragments.filter(function (f) {
    return f in fragImages;
  });

  if (!haveImages.length) {
    return annotationNotHandled(annotation);
  }

  haveImages.map(function (f) {
    var fLocalId = f.substr(f.indexOf("#"));
    var element = component.querySelector(fLocalId);
    var myImage = fragImages[f];

    element.onclick = function () {
      var images = document.querySelectorAll("img");
      Array.prototype.map.call(images, function (i) {
        i.style.visibility = "hidden";
      });
      var query = "img[src='" + myImage + "']";
      document.querySelector(query).style.visibility = "visible";
    };
  });
  return annotationHandled(annotation);
}

function TEIScroll(element) {
  if (element.closest('svg')) {
    var targetClass = false;

    for (var c = 0; c < element.classList.length; c++) {
      if (element.classList[c].indexOf("__") > -1) {
        targetClass = element.classList[c];
        var targetElements = document.getElementsByClassName(targetClass);

        for (var i = 0; i < targetElements.length; i++) {
          var textBox = targetElements[i].closest('.TEIContainer');

          if (textBox) {
            targetElements[i].scrollIntoView;
            textBox.scrollTop = textBox.offsetTop + targetElements[i].offsetTop - textBox.clientHeight / 2;
          }
        }

        return true;
      }
    }
  }

  return true;
}

function handleCueAudio(component, annotation, body, uri, fragments) {
  if ("MEI" in fragments && "Audio" in fragments) {
    fragments.MEI.map(function (f) {
      var fLocalId = f.substr(f.indexOf("#"));
      var element = component.querySelector(fLocalId);

      if (element) {
        //TODO figure out what to do with multiple audio fragments
        var _audioUri = fragments.Audio[0].split("#")[0];
        var _audioFrag = fragments.Audio[0].split("#")[1];

        var _audioFragTime = parseFloat(_audioFrag.substr(_audioFrag.indexOf("t=") + 2));

        element.onclick = function () {
          TEIScroll(element);
          var query = "audio[data-uri='" + _audioUri + "']";
          var myPlayers = document.querySelectorAll(query);
          Array.prototype.map.call(myPlayers, function (p) {
            p.currentTime = _audioFragTime;
          });
        };

        applyAnnotationId(element, annotation);
      }
    });
    return annotationHandled(annotation);
  } // console.log("Cannot handle cue audio without MEI and audio fragments!", fragments);


  return annotationNotHandled(annotation);
}

function handleCueVideo(component, annotation, body, uri, fragments) {
  if ("MEI" in fragments && "Video" in fragments) {
    fragments.MEI.map(function (f) {
      var fLocalId = f.substr(f.indexOf("#"));
      var element = component.querySelector(fLocalId);

      if (element) {
        //TODO figure out what to do with multiple audio fragments
        var videoUri = fragments.video[0].split("#")[0];
        var videoFrag = fragments.video[0].split("#")[1];
        var videoFragTime = parseFloat(audioFrag.substr(videoFrag.indexOf("t=") + 2));

        element.onclick = function () {
          TEIScroll(element);
          var query = "video[data-uri='" + audioUri + "']";
          var myPlayers = document.querySelectorAll(query);
          Array.prototype.map.call(myPlayers, function (p) {
            p.currentTime = audioFragTime;
          });
        };

        applyAnnotationId(element, annotation);
      }
    });
    return annotationHandled(annotation);
  } // console.log("Cannot handle cue audio without MEI and video fragments!", fragments);


  return annotationNotHandled(annotation);
}

function handleEmphasis(component, annotation, uri, fragments) {
  assignClass("meld-emphasis", component, annotation, uri, fragments);
  return annotationHandled();
}

function handleHighlight(component, annotation, uri, fragments) {
  assignClass("meld-highlight", component, annotation, uri, fragments);
  return annotationHandled();
}

function handleHighlight2(component, annotation, uri, fragments) {
  assignClass("meld-highlight2", component, annotation, uri, fragments);
  return annotationHandled();
}

function handleIdentifyMuzicode(component, annotation, uri, fragments) {
  assignClass("meld-muzicode-identify", component, annotation, uri, fragments);
  return annotationHandled();
}

function handleChoiceMuzicode(component, annotation, uri, fragments) {
  // console.log("CHOICE!");
  assignClass("meld-muzicode-choice", component, annotation, uri, fragments);
  return annotationHandled();
}

function handleChallengePassed(component, annotation, uri, fragments) {
  // console.log("Challenge passed!");
  assignClassToClosestMeasure("meld-muzicode-challenge-passed", component, annotation, uri, fragments);
  return annotationHandled();
}

function handleDisklavierStart(component, annotation, uri, fragments) {
  assignClass("meld-muzicode-disklavier-start", component, annotation, uri, fragments);
  return annotationHandled();
}

function handleMuzicodeTriggered(component, annotation, uri, fragments, muzicodeTarget, session, nextSession, etag) {
  // console.log("Muzicode triggered:", component, annotation, uri, fragments, muzicodeTarget, etag);
  return function (dispatch) {
    // dispatch appropriate rendering handler depending on muzicode type
    switch (muzicodeTarget["muzicodeType"]["@id"]) {
      case "mc:Choice":
        dispatch((0, _index.patchAndProcessAnnotation)(handleChoiceMuzicode(component, annotation, uri, fragments), session, etag, annotation, (0, _index.createSession)(session.substr(0, session.lastIndexOf("/")), muzicodeTarget["cue"]["@id"], {
          session: session,
          etag: etag
        })));
        break;

      case "mc:Disklavier":
        dispatch((0, _index.patchAndProcessAnnotation)(handleDisklavierStart(component, annotation, uri, fragments), session, etag, annotation));
        break;

      case "mc:Approaching":
        dispatch((0, _index.patchAndProcessAnnotation)(handleIdentifyMuzicode(component, annotation, uri, fragments), session, etag, annotation));
        break;

      case "mc:Challenge":
        dispatch((0, _index.patchAndProcessAnnotation)(handleChallengePassed(component, annotation, uri, fragments), session, etag, annotation, (0, _index.createSession)(session.substr(0, session.lastIndexOf("/")), muzicodeTarget["cue"]["@id"], {
          session: session,
          etag: etag
        })));
        break;

      default: // console.log("Muzicode of unknown type: ", muzicodeTarget);

    }

    return annotationHandled();
  };
}

function handleArchivedMuzicodeTrigger(component, annotation, uri, fragments, muzicodeTarget, session, nextSession, etag) {
  // console.log("Archived muzicode trigger:", component, annotation, uri, fragments, muzicodeTarget);
  return function (dispatch) {
    // dispatch appropriate rendering handler depending on muzicode type
    switch (muzicodeTarget["muzicodeType"]["@id"]) {
      case "mc:Choice":
        dispatch(handleChoiceMuzicode(component, annotation, uri, fragments));
        dispatch({
          type: QUEUE_NEXT_SESSION,
          payload: muzicodeTarget["cue"]["@id"]
        });
        break;

      case "mc:Disklavier":
        dispatch(handleDisklavierStart(component, annotation, uri, fragments));
        break;

      case "mc:Approaching":
        dispatch(handleIdentifyMuzicode(component, annotation, uri, fragments));
        break;

      case "mc:Challenge":
        dispatch(handleChallengePassed(component, annotation, uri, fragments));
        dispatch({
          type: QUEUE_NEXT_SESSION,
          payload: muzicodeTarget["cue"]["@id"]
        });
        break;

      default: // console.log("Muzicode of unknown type: ", muzicodeTarget);

    }

    return annotationHandled();
  };
}

function handleQueueNextSession(session, etag, annotation) {
  // console.log("Queueing next session: ", annotation);
  return function (dispatch) {
    var action = {
      type: QUEUE_NEXT_SESSION,
      payload: annotation["oa:hasBody"]["@id"]
    }; //dispatch(patchAndProcessAnnotation(action, session, etag, annotation));

    dispatch(action);
  };
}

function handleCreateNextSession(session, etag, annotation) {
  // console.log("Handling createNextSession: ", session, etag, annotation);
  return function (dispatch) {
    dispatch((0, _index.patchAndProcessAnnotation)((0, _index.createSession)(session.substr(0, session.lastIndexOf("/")), annotation["oa:hasBody"]["@id"], {
      etag: etag
    }), session, etag, annotation));
  };
}

function handleTransitionToNextSession(session, etag, annotation) {
  // console.log("Transitioning to next session!");
  return {
    type: _index.TRANSITION_TO_NEXT_SESSION
  };
}

function annotationHandled(annotation) {
  return {
    type: ANNOTATION_HANDLED,
    payload: annotation
  };
}

function annotationNotHandled(annotation) {
  return {
    type: ANNOTATION_NOT_HANDLED,
    payload: annotation
  };
}

function applyAnnotationId(element, annotation) {
  // stamp this element with the specified annotation id
  var id = annotation["@id"].replace(":", "__");

  if (!element.classList.contains(id)) {
    element.classList.add(id);
  }
}

function assignClass(className, component, annotation, uri, fragments) {
  fragments.map(function (f) {
    var fLocalId = f.substr(f.indexOf("#"));
    var element = component.querySelector(fLocalId);

    if (element) {
      if (!element.classList.contains(className)) {
        element.classList.add(className);
      }

      applyAnnotationId(element, annotation);

      element.onmouseover = function () {
        var highlighted = document.querySelectorAll("." + className);
        Array.prototype.map.call(highlighted, function (em) {
          em.classList.add("infocus");
        });
      };

      element.onmouseleave = function () {
        var highlighted = document.querySelectorAll("." + className);
        Array.prototype.map.call(highlighted, function (em) {
          em.classList.remove("infocus");
        });
      };
    }
  });
}

function assignClassToClosestMeasure(className, component, annotation, uri, fragments) {
  // for each fragment, assign the class label to the nearest parent that is an mei measure
  // n.b. could be the fragment itself
  fragments.map(function (f) {
    var fLocalId = f.substr(f.indexOf("#"));
    var element = component.querySelector(fLocalId);
    var closestMeasure = element ? element.closest(".measure") : null;

    if (closestMeasure) {
      if (!closestMeasure.classList.contains(className)) {
        closestMeasure.classList.add(className);
      }

      applyAnnotationId(closestMeasure, annotation);

      closestMeasure.onmouseover = function () {
        var highlighted = document.querySelectorAll("." + className);
        Array.prototype.map.call(highlighted, function (em) {
          em.classList.add("infocus");
        });
      };

      closestMeasure.onmouseleave = function () {
        var highlighted = document.querySelectorAll("." + className);
        Array.prototype.map.call(highlighted, function (em) {
          em.classList.remove("infocus");
        });
      };
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY3Rpb25zL21lbGRBY3Rpb25zLmpzIl0sIm5hbWVzIjpbIk1BUktVUF9FTVBIQVNJUyIsIk1BUktVUF9ISUdITElHSFQiLCJNQVJLVVBfSElHSExJR0hUMiIsIkNVRV9BVURJTyIsIkNVRV9BVURJT19IQU5ETEVEIiwiQ1VFX1ZJREVPIiwiQ1VFX1ZJREVPX0hBTkRMRUQiLCJDVUVfSU1BR0UiLCJDVUVfSU1BR0VfSEFORExFRCIsIkFOTk9UQVRJT05fSEFORExFRCIsIkFOTk9UQVRJT05fTk9UX0hBTkRMRUQiLCJBTk5PVEFUSU9OX1BBVENIRUQiLCJBTk5PVEFUSU9OX1BPU1RFRCIsIkFOTk9UQVRJT05fU0tJUFBFRCIsIlFVRVVFX05FWFRfU0VTU0lPTiIsImhhbmRsZUN1ZUltYWdlIiwiY29tcG9uZW50IiwiYW5ub3RhdGlvbiIsInVyaSIsImZyYWdtZW50cyIsImZyYWdJbWFnZXMiLCJoYXZlSW1hZ2VzIiwiZmlsdGVyIiwiZiIsImxlbmd0aCIsImFubm90YXRpb25Ob3RIYW5kbGVkIiwibWFwIiwiZkxvY2FsSWQiLCJzdWJzdHIiLCJpbmRleE9mIiwiZWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJteUltYWdlIiwib25jbGljayIsImltYWdlcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsIkFycmF5IiwicHJvdG90eXBlIiwiY2FsbCIsImkiLCJzdHlsZSIsInZpc2liaWxpdHkiLCJxdWVyeSIsImFubm90YXRpb25IYW5kbGVkIiwiVEVJU2Nyb2xsIiwiY2xvc2VzdCIsInRhcmdldENsYXNzIiwiYyIsImNsYXNzTGlzdCIsInRhcmdldEVsZW1lbnRzIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsInRleHRCb3giLCJzY3JvbGxJbnRvVmlldyIsInNjcm9sbFRvcCIsIm9mZnNldFRvcCIsImNsaWVudEhlaWdodCIsImhhbmRsZUN1ZUF1ZGlvIiwiYm9keSIsIk1FSSIsImF1ZGlvVXJpIiwiQXVkaW8iLCJzcGxpdCIsImF1ZGlvRnJhZyIsImF1ZGlvRnJhZ1RpbWUiLCJwYXJzZUZsb2F0IiwibXlQbGF5ZXJzIiwicCIsImN1cnJlbnRUaW1lIiwiYXBwbHlBbm5vdGF0aW9uSWQiLCJoYW5kbGVDdWVWaWRlbyIsInZpZGVvVXJpIiwidmlkZW8iLCJ2aWRlb0ZyYWciLCJ2aWRlb0ZyYWdUaW1lIiwiaGFuZGxlRW1waGFzaXMiLCJhc3NpZ25DbGFzcyIsImhhbmRsZUhpZ2hsaWdodCIsImhhbmRsZUhpZ2hsaWdodDIiLCJoYW5kbGVJZGVudGlmeU11emljb2RlIiwiaGFuZGxlQ2hvaWNlTXV6aWNvZGUiLCJoYW5kbGVDaGFsbGVuZ2VQYXNzZWQiLCJhc3NpZ25DbGFzc1RvQ2xvc2VzdE1lYXN1cmUiLCJoYW5kbGVEaXNrbGF2aWVyU3RhcnQiLCJoYW5kbGVNdXppY29kZVRyaWdnZXJlZCIsIm11emljb2RlVGFyZ2V0Iiwic2Vzc2lvbiIsIm5leHRTZXNzaW9uIiwiZXRhZyIsImRpc3BhdGNoIiwibGFzdEluZGV4T2YiLCJoYW5kbGVBcmNoaXZlZE11emljb2RlVHJpZ2dlciIsInR5cGUiLCJwYXlsb2FkIiwiaGFuZGxlUXVldWVOZXh0U2Vzc2lvbiIsImFjdGlvbiIsImhhbmRsZUNyZWF0ZU5leHRTZXNzaW9uIiwiaGFuZGxlVHJhbnNpdGlvblRvTmV4dFNlc3Npb24iLCJUUkFOU0lUSU9OX1RPX05FWFRfU0VTU0lPTiIsImlkIiwicmVwbGFjZSIsImNvbnRhaW5zIiwiYWRkIiwiY2xhc3NOYW1lIiwib25tb3VzZW92ZXIiLCJoaWdobGlnaHRlZCIsImVtIiwib25tb3VzZWxlYXZlIiwicmVtb3ZlIiwiY2xvc2VzdE1lYXN1cmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRU8sSUFBTUEsZUFBZSxHQUFHLG1CQUF4Qjs7QUFDQSxJQUFNQyxnQkFBZ0IsR0FBRyxvQkFBekI7O0FBQ0EsSUFBTUMsaUJBQWlCLEdBQUcscUJBQTFCOztBQUNBLElBQU1DLFNBQVMsR0FBRyxtQkFBbEI7O0FB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QUFPLENBQUNnQixPQUFSLENBQWdCLFVBQWhCLENBQUgsR0FBaUMsSUFBL0Q7O0FBQ0EsUUFBSStELGNBQUosRUFBb0I7QUFDbEIsVUFBSSxDQUFDQSxjQUFjLENBQUM1RCxTQUFmLENBQXlCb0QsUUFBekIsQ0FBa0NFLFNBQWxDLENBQUwsRUFBbUQ7QUFDakRNLFFBQUFBLGNBQWMsQ0FBQzVELFNBQWYsQ0FBeUJxRCxHQUF6QixDQUE2QkMsU0FBN0I7QUFDRDs7QUFDRGxDLE1BQUFBLGlCQUFpQixDQUFDd0MsY0FBRCxFQUFpQjVGLFVBQWpCLENBQWpCOztBQUNBNEYsTUFBQUEsY0FBYyxDQUFDTCxXQUFmLEdBQTZCLFlBQVk7QUFDdkMsWUFBSUMsV0FBVyxHQUFHdEUsUUFBUSxDQUFDQyxnQkFBVCxDQUEwQixNQUFNbUUsU0FBaEMsQ0FBbEI7QUFDQWxFLFFBQUFBLEtBQUssQ0FBQ0MsU0FBTixDQUFnQlosR0FBaEIsQ0FBb0JhLElBQXBCLENBQXlCa0UsV0FBekIsRUFBc0MsVUFBVUMsRUFBVixFQUFjO0FBQ2xEQSxVQUFBQSxFQUFFLENBQUN6RCxTQUFILENBQWFxRCxHQUFiLENBQWlCLFNBQWpCO0FBQ0QsU0FGRDtBQUdELE9BTEQ7O0FBTUFPLE1BQUFBLGNBQWMsQ0FBQ0YsWUFBZixHQUE4QixZQUFZO0FBQ3hDLFlBQUlGLFdBQVcsR0FBR3RFLFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEIsTUFBTW1FLFNBQWhDLENBQWxCO0FBQ0FsRSxRQUFBQSxLQUFLLENBQUNDLFNBQU4sQ0FBZ0JaLEdBQWhCLENBQW9CYSxJQUFwQixDQUF5QmtFLFdBQXpCLEVBQXNDLFVBQVVDLEVBQVYsRUFBYztBQUNsREEsVUFBQUEsRUFBRSxDQUFDekQsU0FBSCxDQUFhMkQsTUFBYixDQUFvQixTQUFwQjtBQUNELFNBRkQ7QUFHRCxPQUxEO0FBTUQ7QUFDRixHQXRCRDtBQXVCRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Y3JlYXRlU2Vzc2lvbiwgcGF0Y2hBbmRQcm9jZXNzQW5ub3RhdGlvbiwgVFJBTlNJVElPTl9UT19ORVhUX1NFU1NJT059IGZyb20gJy4vaW5kZXgnXG5cbmV4cG9ydCBjb25zdCBNQVJLVVBfRU1QSEFTSVMgPSBcIm1lbGR0ZXJtOmVtcGhhc2lzXCI7XG5leHBvcnQgY29uc3QgTUFSS1VQX0hJR0hMSUdIVCA9IFwibWVsZHRlcm06aGlnaGxpZ2h0XCI7XG5leHBvcnQgY29uc3QgTUFSS1VQX0hJR0hMSUdIVDIgPSBcIm1lbGR0ZXJtOmhpZ2hsaWdodDJcIjtcbmV4cG9ydCBjb25zdCBDVUVfQVVESU8gPSBcIm1lbGR0ZXJtOkN1ZUF1ZGlvXCI7XG5leHBvcnQgY29uc3QgQ1VFX0FVRElPX0hBTkRMRUQgPSBcIkNVRV9BVURJT19IQU5ETEVEXCI7XG5leHBvcnQgY29uc3QgQ1VFX1ZJREVPID0gXCJtZWxkdGVybTpDdWVWaWRlb1wiO1xuZXhwb3J0IGNvbnN0IENVRV9WSURFT19IQU5ETEVEID0gXCJDVUVfVklERU9fSEFORExFRFwiO1xuZXhwb3J0IGNvbnN0IENVRV9JTUFHRSA9IFwibWVsZHRlcm06Q3VlSW1hZ2VcIjtcbmV4cG9ydCBjb25zdCBDVUVfSU1BR0VfSEFORExFRCA9IFwiQ1VFX0lNQUdFX0hBTkRMRURcIjtcbmV4cG9ydCBjb25zdCBBTk5PVEFUSU9OX0hBTkRMRUQgPSBcIkFOTk9UQVRJT05fSEFORExFRFwiO1xuZXhwb3J0IGNvbnN0IEFOTk9UQVRJT05fTk9UX0hBTkRMRUQgPSBcIkFOTk9UQVRJT05fTk9UX0hBTkRMRURcIjtcbmV4cG9ydCBjb25zdCBBTk5PVEFUSU9OX1BBVENIRUQgPSBcIkFOTk9UQVRJT05fUEFUQ0hFRFwiO1xuZXhwb3J0IGNvbnN0IEFOTk9UQVRJT05fUE9TVEVEID0gXCJBTk5PVEFUSU9OX1BPU1RFRFwiO1xuZXhwb3J0IGNvbnN0IEFOTk9UQVRJT05fU0tJUFBFRCA9IFwiQU5OT1RBVElPTl9TS0lQUEVEXCI7XG5leHBvcnQgY29uc3QgUVVFVUVfTkVYVF9TRVNTSU9OID0gXCJRVUVVRV9ORVhUX1NFU1NJT05cIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUN1ZUltYWdlKGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMsIGZyYWdJbWFnZXMpIHtcbiAgY29uc3QgaGF2ZUltYWdlcyA9IGZyYWdtZW50cy5maWx0ZXIoKGYpID0+IGYgaW4gZnJhZ0ltYWdlcyk7XG4gIGlmICghaGF2ZUltYWdlcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gYW5ub3RhdGlvbk5vdEhhbmRsZWQoYW5ub3RhdGlvbilcbiAgfVxuICBoYXZlSW1hZ2VzLm1hcCgoZikgPT4ge1xuICAgIGNvbnN0IGZMb2NhbElkID0gZi5zdWJzdHIoZi5pbmRleE9mKFwiI1wiKSk7XG4gICAgY29uc3QgZWxlbWVudCA9IGNvbXBvbmVudC5xdWVyeVNlbGVjdG9yKGZMb2NhbElkKTtcbiAgICBjb25zdCBteUltYWdlID0gZnJhZ0ltYWdlc1tmXTtcbiAgICBlbGVtZW50Lm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgaW1hZ2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcImltZ1wiKTtcbiAgICAgIEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbChpbWFnZXMsIGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIGkuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCJcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcXVlcnkgPSBcImltZ1tzcmM9J1wiICsgbXlJbWFnZSArIFwiJ11cIjtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocXVlcnkpLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gYW5ub3RhdGlvbkhhbmRsZWQoYW5ub3RhdGlvbilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFRFSVNjcm9sbChlbGVtZW50KSB7XG4gIGlmIChlbGVtZW50LmNsb3Nlc3QoJ3N2ZycpKSB7XG4gICAgdmFyIHRhcmdldENsYXNzID0gZmFsc2U7XG4gICAgZm9yICh2YXIgYyA9IDA7IGMgPCBlbGVtZW50LmNsYXNzTGlzdC5sZW5ndGg7IGMrKykge1xuICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0W2NdLmluZGV4T2YoXCJfX1wiKSA+IC0xKSB7XG4gICAgICAgIHRhcmdldENsYXNzID0gZWxlbWVudC5jbGFzc0xpc3RbY107XG4gICAgICAgIHZhciB0YXJnZXRFbGVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodGFyZ2V0Q2xhc3MpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhcmdldEVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHRleHRCb3ggPSB0YXJnZXRFbGVtZW50c1tpXS5jbG9zZXN0KCcuVEVJQ29udGFpbmVyJyk7XG4gICAgICAgICAgaWYgKHRleHRCb3gpIHtcbiAgICAgICAgICAgIHRhcmdldEVsZW1lbnRzW2ldLnNjcm9sbEludG9WaWV3O1xuICAgICAgICAgICAgdGV4dEJveC5zY3JvbGxUb3AgPSB0ZXh0Qm94Lm9mZnNldFRvcCArIHRhcmdldEVsZW1lbnRzW2ldLm9mZnNldFRvcCAtICh0ZXh0Qm94LmNsaWVudEhlaWdodCAvIDIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVDdWVBdWRpbyhjb21wb25lbnQsIGFubm90YXRpb24sIGJvZHksIHVyaSwgZnJhZ21lbnRzKSB7XG4gIGlmIChcIk1FSVwiIGluIGZyYWdtZW50cyAmJiBcIkF1ZGlvXCIgaW4gZnJhZ21lbnRzKSB7XG4gICAgZnJhZ21lbnRzLk1FSS5tYXAoKGYpID0+IHtcbiAgICAgIGNvbnN0IGZMb2NhbElkID0gZi5zdWJzdHIoZi5pbmRleE9mKFwiI1wiKSk7XG4gICAgICBjb25zdCBlbGVtZW50ID0gY29tcG9uZW50LnF1ZXJ5U2VsZWN0b3IoZkxvY2FsSWQpO1xuICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgLy9UT0RPIGZpZ3VyZSBvdXQgd2hhdCB0byBkbyB3aXRoIG11bHRpcGxlIGF1ZGlvIGZyYWdtZW50c1xuICAgICAgICBjb25zdCBhdWRpb1VyaSA9IGZyYWdtZW50cy5BdWRpb1swXS5zcGxpdChcIiNcIilbMF07XG4gICAgICAgIGNvbnN0IGF1ZGlvRnJhZyA9IGZyYWdtZW50cy5BdWRpb1swXS5zcGxpdChcIiNcIilbMV07XG4gICAgICAgIGNvbnN0IGF1ZGlvRnJhZ1RpbWUgPSBwYXJzZUZsb2F0KGF1ZGlvRnJhZy5zdWJzdHIoYXVkaW9GcmFnLmluZGV4T2YoXCJ0PVwiKSArIDIpKTtcbiAgICAgICAgZWxlbWVudC5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIFRFSVNjcm9sbChlbGVtZW50KTtcbiAgICAgICAgICBjb25zdCBxdWVyeSA9IFwiYXVkaW9bZGF0YS11cmk9J1wiICsgYXVkaW9VcmkgKyBcIiddXCI7XG4gICAgICAgICAgbGV0IG15UGxheWVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXVlcnkpO1xuICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbChteVBsYXllcnMsIGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgICBwLmN1cnJlbnRUaW1lID0gYXVkaW9GcmFnVGltZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBhcHBseUFubm90YXRpb25JZChlbGVtZW50LCBhbm5vdGF0aW9uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gYW5ub3RhdGlvbkhhbmRsZWQoYW5ub3RhdGlvbik7XG4gIH1cbiAgLy8gY29uc29sZS5sb2coXCJDYW5ub3QgaGFuZGxlIGN1ZSBhdWRpbyB3aXRob3V0IE1FSSBhbmQgYXVkaW8gZnJhZ21lbnRzIVwiLCBmcmFnbWVudHMpO1xuICByZXR1cm4gYW5ub3RhdGlvbk5vdEhhbmRsZWQoYW5ub3RhdGlvbik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVDdWVWaWRlbyhjb21wb25lbnQsIGFubm90YXRpb24sIGJvZHksIHVyaSwgZnJhZ21lbnRzKSB7XG4gIGlmIChcIk1FSVwiIGluIGZyYWdtZW50cyAmJiBcIlZpZGVvXCIgaW4gZnJhZ21lbnRzKSB7XG4gICAgZnJhZ21lbnRzLk1FSS5tYXAoKGYpID0+IHtcbiAgICAgIGNvbnN0IGZMb2NhbElkID0gZi5zdWJzdHIoZi5pbmRleE9mKFwiI1wiKSk7XG4gICAgICBjb25zdCBlbGVtZW50ID0gY29tcG9uZW50LnF1ZXJ5U2VsZWN0b3IoZkxvY2FsSWQpO1xuICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgLy9UT0RPIGZpZ3VyZSBvdXQgd2hhdCB0byBkbyB3aXRoIG11bHRpcGxlIGF1ZGlvIGZyYWdtZW50c1xuICAgICAgICBjb25zdCB2aWRlb1VyaSA9IGZyYWdtZW50cy52aWRlb1swXS5zcGxpdChcIiNcIilbMF07XG4gICAgICAgIGNvbnN0IHZpZGVvRnJhZyA9IGZyYWdtZW50cy52aWRlb1swXS5zcGxpdChcIiNcIilbMV07XG4gICAgICAgIGNvbnN0IHZpZGVvRnJhZ1RpbWUgPSBwYXJzZUZsb2F0KGF1ZGlvRnJhZy5zdWJzdHIodmlkZW9GcmFnLmluZGV4T2YoXCJ0PVwiKSArIDIpKTtcbiAgICAgICAgZWxlbWVudC5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIFRFSVNjcm9sbChlbGVtZW50KTtcbiAgICAgICAgICBjb25zdCBxdWVyeSA9IFwidmlkZW9bZGF0YS11cmk9J1wiICsgYXVkaW9VcmkgKyBcIiddXCI7XG4gICAgICAgICAgbGV0IG15UGxheWVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXVlcnkpO1xuICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbChteVBsYXllcnMsIGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgICBwLmN1cnJlbnRUaW1lID0gYXVkaW9GcmFnVGltZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBhcHBseUFubm90YXRpb25JZChlbGVtZW50LCBhbm5vdGF0aW9uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gYW5ub3RhdGlvbkhhbmRsZWQoYW5ub3RhdGlvbik7XG4gIH1cbiAgLy8gY29uc29sZS5sb2coXCJDYW5ub3QgaGFuZGxlIGN1ZSBhdWRpbyB3aXRob3V0IE1FSSBhbmQgdmlkZW8gZnJhZ21lbnRzIVwiLCBmcmFnbWVudHMpO1xuICByZXR1cm4gYW5ub3RhdGlvbk5vdEhhbmRsZWQoYW5ub3RhdGlvbik7XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUVtcGhhc2lzKGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpIHtcbiAgYXNzaWduQ2xhc3MoXCJtZWxkLWVtcGhhc2lzXCIsIGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpO1xuICByZXR1cm4gYW5ub3RhdGlvbkhhbmRsZWQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUhpZ2hsaWdodChjb21wb25lbnQsIGFubm90YXRpb24sIHVyaSwgZnJhZ21lbnRzKSB7XG4gIGFzc2lnbkNsYXNzKFwibWVsZC1oaWdobGlnaHRcIiwgY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cyk7XG4gIHJldHVybiBhbm5vdGF0aW9uSGFuZGxlZCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlSGlnaGxpZ2h0Mihjb21wb25lbnQsIGFubm90YXRpb24sIHVyaSwgZnJhZ21lbnRzKSB7XG4gIGFzc2lnbkNsYXNzKFwibWVsZC1oaWdobGlnaHQyXCIsIGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpO1xuICByZXR1cm4gYW5ub3RhdGlvbkhhbmRsZWQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUlkZW50aWZ5TXV6aWNvZGUoY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cykge1xuICBhc3NpZ25DbGFzcyhcIm1lbGQtbXV6aWNvZGUtaWRlbnRpZnlcIiwgY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cyk7XG4gIHJldHVybiBhbm5vdGF0aW9uSGFuZGxlZCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQ2hvaWNlTXV6aWNvZGUoY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cykge1xuICAvLyBjb25zb2xlLmxvZyhcIkNIT0lDRSFcIik7XG4gIGFzc2lnbkNsYXNzKFwibWVsZC1tdXppY29kZS1jaG9pY2VcIiwgY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cyk7XG4gIHJldHVybiBhbm5vdGF0aW9uSGFuZGxlZCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQ2hhbGxlbmdlUGFzc2VkKGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpIHtcbiAgLy8gY29uc29sZS5sb2coXCJDaGFsbGVuZ2UgcGFzc2VkIVwiKTtcbiAgYXNzaWduQ2xhc3NUb0Nsb3Nlc3RNZWFzdXJlKFwibWVsZC1tdXppY29kZS1jaGFsbGVuZ2UtcGFzc2VkXCIsIGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpO1xuICByZXR1cm4gYW5ub3RhdGlvbkhhbmRsZWQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZURpc2tsYXZpZXJTdGFydChjb21wb25lbnQsIGFubm90YXRpb24sIHVyaSwgZnJhZ21lbnRzKSB7XG4gIGFzc2lnbkNsYXNzKFwibWVsZC1tdXppY29kZS1kaXNrbGF2aWVyLXN0YXJ0XCIsIGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpO1xuICByZXR1cm4gYW5ub3RhdGlvbkhhbmRsZWQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZU11emljb2RlVHJpZ2dlcmVkKGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMsIG11emljb2RlVGFyZ2V0LCBzZXNzaW9uLCBuZXh0U2Vzc2lvbiwgZXRhZykge1xuICAvLyBjb25zb2xlLmxvZyhcIk11emljb2RlIHRyaWdnZXJlZDpcIiwgY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cywgbXV6aWNvZGVUYXJnZXQsIGV0YWcpO1xuICByZXR1cm4gKGRpc3BhdGNoKSA9PiB7XG4gICAgLy8gZGlzcGF0Y2ggYXBwcm9wcmlhdGUgcmVuZGVyaW5nIGhhbmRsZXIgZGVwZW5kaW5nIG9uIG11emljb2RlIHR5cGVcbiAgICBzd2l0Y2ggKG11emljb2RlVGFyZ2V0W1wibXV6aWNvZGVUeXBlXCJdW1wiQGlkXCJdKSB7XG4gICAgICBjYXNlIFwibWM6Q2hvaWNlXCI6XG4gICAgICAgIGRpc3BhdGNoKFxuICAgICAgICAgICAgcGF0Y2hBbmRQcm9jZXNzQW5ub3RhdGlvbihcbiAgICAgICAgICAgICAgICBoYW5kbGVDaG9pY2VNdXppY29kZShjb21wb25lbnQsIGFubm90YXRpb24sIHVyaSwgZnJhZ21lbnRzKSxcbiAgICAgICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgICAgIGV0YWcsXG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbixcbiAgICAgICAgICAgICAgICBjcmVhdGVTZXNzaW9uKFxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnN1YnN0cigwLCBzZXNzaW9uLmxhc3RJbmRleE9mKFwiL1wiKSksXG4gICAgICAgICAgICAgICAgICAgIG11emljb2RlVGFyZ2V0W1wiY3VlXCJdW1wiQGlkXCJdLFxuICAgICAgICAgICAgICAgICAgICB7c2Vzc2lvbiwgZXRhZ31cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1jOkRpc2tsYXZpZXJcIjpcbiAgICAgICAgZGlzcGF0Y2goXG4gICAgICAgICAgICBwYXRjaEFuZFByb2Nlc3NBbm5vdGF0aW9uKFxuICAgICAgICAgICAgICAgIGhhbmRsZURpc2tsYXZpZXJTdGFydChjb21wb25lbnQsIGFubm90YXRpb24sIHVyaSwgZnJhZ21lbnRzKSxcbiAgICAgICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgICAgIGV0YWcsXG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvblxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtYzpBcHByb2FjaGluZ1wiOlxuICAgICAgICBkaXNwYXRjaChcbiAgICAgICAgICAgIHBhdGNoQW5kUHJvY2Vzc0Fubm90YXRpb24oXG4gICAgICAgICAgICAgICAgaGFuZGxlSWRlbnRpZnlNdXppY29kZShjb21wb25lbnQsIGFubm90YXRpb24sIHVyaSwgZnJhZ21lbnRzKSxcbiAgICAgICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgICAgIGV0YWcsXG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvblxuICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtYzpDaGFsbGVuZ2VcIjpcbiAgICAgICAgZGlzcGF0Y2goXG4gICAgICAgICAgICBwYXRjaEFuZFByb2Nlc3NBbm5vdGF0aW9uKFxuICAgICAgICAgICAgICAgIGhhbmRsZUNoYWxsZW5nZVBhc3NlZChjb21wb25lbnQsIGFubm90YXRpb24sIHVyaSwgZnJhZ21lbnRzKSxcbiAgICAgICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgICAgIGV0YWcsXG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbixcbiAgICAgICAgICAgICAgICBjcmVhdGVTZXNzaW9uKFxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnN1YnN0cigwLCBzZXNzaW9uLmxhc3RJbmRleE9mKFwiL1wiKSksXG4gICAgICAgICAgICAgICAgICAgIG11emljb2RlVGFyZ2V0W1wiY3VlXCJdW1wiQGlkXCJdLFxuICAgICAgICAgICAgICAgICAgICB7c2Vzc2lvbiwgZXRhZ31cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJNdXppY29kZSBvZiB1bmtub3duIHR5cGU6IFwiLCBtdXppY29kZVRhcmdldCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFubm90YXRpb25IYW5kbGVkKCk7XG5cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQXJjaGl2ZWRNdXppY29kZVRyaWdnZXIoY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cywgbXV6aWNvZGVUYXJnZXQsIHNlc3Npb24sIG5leHRTZXNzaW9uLCBldGFnKSB7XG4gIC8vIGNvbnNvbGUubG9nKFwiQXJjaGl2ZWQgbXV6aWNvZGUgdHJpZ2dlcjpcIiwgY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cywgbXV6aWNvZGVUYXJnZXQpO1xuICByZXR1cm4gKGRpc3BhdGNoKSA9PiB7XG4gICAgLy8gZGlzcGF0Y2ggYXBwcm9wcmlhdGUgcmVuZGVyaW5nIGhhbmRsZXIgZGVwZW5kaW5nIG9uIG11emljb2RlIHR5cGVcbiAgICBzd2l0Y2ggKG11emljb2RlVGFyZ2V0W1wibXV6aWNvZGVUeXBlXCJdW1wiQGlkXCJdKSB7XG4gICAgICBjYXNlIFwibWM6Q2hvaWNlXCI6XG4gICAgICAgIGRpc3BhdGNoKGhhbmRsZUNob2ljZU11emljb2RlKGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpKTtcbiAgICAgICAgZGlzcGF0Y2goe1xuICAgICAgICAgIHR5cGU6IFFVRVVFX05FWFRfU0VTU0lPTixcbiAgICAgICAgICBwYXlsb2FkOiBtdXppY29kZVRhcmdldFtcImN1ZVwiXVtcIkBpZFwiXVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibWM6RGlza2xhdmllclwiOlxuICAgICAgICBkaXNwYXRjaChoYW5kbGVEaXNrbGF2aWVyU3RhcnQoY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cykpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtYzpBcHByb2FjaGluZ1wiOlxuICAgICAgICBkaXNwYXRjaChoYW5kbGVJZGVudGlmeU11emljb2RlKGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibWM6Q2hhbGxlbmdlXCI6XG4gICAgICAgIGRpc3BhdGNoKGhhbmRsZUNoYWxsZW5nZVBhc3NlZChjb21wb25lbnQsIGFubm90YXRpb24sIHVyaSwgZnJhZ21lbnRzKSk7XG4gICAgICAgIGRpc3BhdGNoKHtcbiAgICAgICAgICB0eXBlOiBRVUVVRV9ORVhUX1NFU1NJT04sXG4gICAgICAgICAgcGF5bG9hZDogbXV6aWNvZGVUYXJnZXRbXCJjdWVcIl1bXCJAaWRcIl1cbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJNdXppY29kZSBvZiB1bmtub3duIHR5cGU6IFwiLCBtdXppY29kZVRhcmdldCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFubm90YXRpb25IYW5kbGVkKCk7XG5cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlUXVldWVOZXh0U2Vzc2lvbihzZXNzaW9uLCBldGFnLCBhbm5vdGF0aW9uKSB7XG4gIC8vIGNvbnNvbGUubG9nKFwiUXVldWVpbmcgbmV4dCBzZXNzaW9uOiBcIiwgYW5ub3RhdGlvbik7XG4gIHJldHVybiAoZGlzcGF0Y2gpID0+IHtcbiAgICBjb25zdCBhY3Rpb24gPSB7XG4gICAgICB0eXBlOiBRVUVVRV9ORVhUX1NFU1NJT04sXG4gICAgICBwYXlsb2FkOiBhbm5vdGF0aW9uW1wib2E6aGFzQm9keVwiXVtcIkBpZFwiXVxuICAgIH07XG4gICAgLy9kaXNwYXRjaChwYXRjaEFuZFByb2Nlc3NBbm5vdGF0aW9uKGFjdGlvbiwgc2Vzc2lvbiwgZXRhZywgYW5ub3RhdGlvbikpO1xuICAgIGRpc3BhdGNoKGFjdGlvbik7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUNyZWF0ZU5leHRTZXNzaW9uKHNlc3Npb24sIGV0YWcsIGFubm90YXRpb24pIHtcbiAgLy8gY29uc29sZS5sb2coXCJIYW5kbGluZyBjcmVhdGVOZXh0U2Vzc2lvbjogXCIsIHNlc3Npb24sIGV0YWcsIGFubm90YXRpb24pO1xuICByZXR1cm4gKGRpc3BhdGNoKSA9PiB7XG4gICAgZGlzcGF0Y2goXG4gICAgICAgIHBhdGNoQW5kUHJvY2Vzc0Fubm90YXRpb24oXG4gICAgICAgICAgICBjcmVhdGVTZXNzaW9uKFxuICAgICAgICAgICAgICAgIHNlc3Npb24uc3Vic3RyKDAsIHNlc3Npb24ubGFzdEluZGV4T2YoXCIvXCIpKSxcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uW1wib2E6aGFzQm9keVwiXVtcIkBpZFwiXSxcbiAgICAgICAgICAgICAgICB7ZXRhZzogZXRhZ31cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgZXRhZyxcbiAgICAgICAgICAgIGFubm90YXRpb25cbiAgICAgICAgKVxuICAgIClcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlVHJhbnNpdGlvblRvTmV4dFNlc3Npb24oc2Vzc2lvbiwgZXRhZywgYW5ub3RhdGlvbikge1xuICAvLyBjb25zb2xlLmxvZyhcIlRyYW5zaXRpb25pbmcgdG8gbmV4dCBzZXNzaW9uIVwiKTtcbiAgcmV0dXJuIHt0eXBlOiBUUkFOU0lUSU9OX1RPX05FWFRfU0VTU0lPTn1cbn1cblxuXG5mdW5jdGlvbiBhbm5vdGF0aW9uSGFuZGxlZChhbm5vdGF0aW9uKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogQU5OT1RBVElPTl9IQU5ETEVELFxuICAgIHBheWxvYWQ6IGFubm90YXRpb25cbiAgfVxufVxuXG5mdW5jdGlvbiBhbm5vdGF0aW9uTm90SGFuZGxlZChhbm5vdGF0aW9uKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogQU5OT1RBVElPTl9OT1RfSEFORExFRCxcbiAgICBwYXlsb2FkOiBhbm5vdGF0aW9uXG4gIH1cbn1cblxuZnVuY3Rpb24gYXBwbHlBbm5vdGF0aW9uSWQoZWxlbWVudCwgYW5ub3RhdGlvbikge1xuICAvLyBzdGFtcCB0aGlzIGVsZW1lbnQgd2l0aCB0aGUgc3BlY2lmaWVkIGFubm90YXRpb24gaWRcbiAgY29uc3QgaWQgPSBhbm5vdGF0aW9uW1wiQGlkXCJdLnJlcGxhY2UoXCI6XCIsIFwiX19cIik7XG4gIGlmICghZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoaWQpKSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGlkKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NpZ25DbGFzcyhjbGFzc05hbWUsIGNvbXBvbmVudCwgYW5ub3RhdGlvbiwgdXJpLCBmcmFnbWVudHMpIHtcbiAgZnJhZ21lbnRzLm1hcCgoZikgPT4ge1xuICAgIGNvbnN0IGZMb2NhbElkID0gZi5zdWJzdHIoZi5pbmRleE9mKFwiI1wiKSk7XG4gICAgY29uc3QgZWxlbWVudCA9IGNvbXBvbmVudC5xdWVyeVNlbGVjdG9yKGZMb2NhbElkKTtcbiAgICBpZiAoZWxlbWVudCkge1xuICAgICAgaWYgKCFlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpKSB7XG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgICAgfVxuICAgICAgYXBwbHlBbm5vdGF0aW9uSWQoZWxlbWVudCwgYW5ub3RhdGlvbik7XG4gICAgICBlbGVtZW50Lm9ubW91c2VvdmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgaGlnaGxpZ2h0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLlwiICsgY2xhc3NOYW1lKTtcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLm1hcC5jYWxsKGhpZ2hsaWdodGVkLCBmdW5jdGlvbiAoZW0pIHtcbiAgICAgICAgICBlbS5jbGFzc0xpc3QuYWRkKFwiaW5mb2N1c1wiKVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICBlbGVtZW50Lm9ubW91c2VsZWF2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IGhpZ2hsaWdodGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5cIiArIGNsYXNzTmFtZSk7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbChoaWdobGlnaHRlZCwgZnVuY3Rpb24gKGVtKSB7XG4gICAgICAgICAgZW0uY2xhc3NMaXN0LnJlbW92ZShcImluZm9jdXNcIilcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gYXNzaWduQ2xhc3NUb0Nsb3Nlc3RNZWFzdXJlKGNsYXNzTmFtZSwgY29tcG9uZW50LCBhbm5vdGF0aW9uLCB1cmksIGZyYWdtZW50cykge1xuICAvLyBmb3IgZWFjaCBmcmFnbWVudCwgYXNzaWduIHRoZSBjbGFzcyBsYWJlbCB0byB0aGUgbmVhcmVzdCBwYXJlbnQgdGhhdCBpcyBhbiBtZWkgbWVhc3VyZVxuICAvLyBuLmIuIGNvdWxkIGJlIHRoZSBmcmFnbWVudCBpdHNlbGZcbiAgZnJhZ21lbnRzLm1hcCgoZikgPT4ge1xuICAgIGNvbnN0IGZMb2NhbElkID0gZi5zdWJzdHIoZi5pbmRleE9mKFwiI1wiKSk7XG4gICAgY29uc3QgZWxlbWVudCA9IGNvbXBvbmVudC5xdWVyeVNlbGVjdG9yKGZMb2NhbElkKTtcbiAgICBjb25zdCBjbG9zZXN0TWVhc3VyZSA9IGVsZW1lbnQgPyBlbGVtZW50LmNsb3Nlc3QoXCIubWVhc3VyZVwiKSA6IG51bGw7XG4gICAgaWYgKGNsb3Nlc3RNZWFzdXJlKSB7XG4gICAgICBpZiAoIWNsb3Nlc3RNZWFzdXJlLmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpKSB7XG4gICAgICAgIGNsb3Nlc3RNZWFzdXJlLmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcbiAgICAgIH1cbiAgICAgIGFwcGx5QW5ub3RhdGlvbklkKGNsb3Nlc3RNZWFzdXJlLCBhbm5vdGF0aW9uKTtcbiAgICAgIGNsb3Nlc3RNZWFzdXJlLm9ubW91c2VvdmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgaGlnaGxpZ2h0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLlwiICsgY2xhc3NOYW1lKTtcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLm1hcC5jYWxsKGhpZ2hsaWdodGVkLCBmdW5jdGlvbiAoZW0pIHtcbiAgICAgICAgICBlbS5jbGFzc0xpc3QuYWRkKFwiaW5mb2N1c1wiKVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICBjbG9zZXN0TWVhc3VyZS5vbm1vdXNlbGVhdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBoaWdobGlnaHRlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuXCIgKyBjbGFzc05hbWUpO1xuICAgICAgICBBcnJheS5wcm90b3R5cGUubWFwLmNhbGwoaGlnaGxpZ2h0ZWQsIGZ1bmN0aW9uIChlbSkge1xuICAgICAgICAgIGVtLmNsYXNzTGlzdC5yZW1vdmUoXCJpbmZvY3VzXCIpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG4iXX0=